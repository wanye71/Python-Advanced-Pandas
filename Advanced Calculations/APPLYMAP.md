# Advanced Pandas - Advanced Calculations

## Apply, Map and Applymap in Pandas
```python

# Import the pandas library and assign it the alias 'pd'
import pandas as pd

import warnings
# Suppress FutureWarning messages
warnings.simplefilter(action='ignore', category=FutureWarning)

# Create a DataFrame 'df' containing information about 
# revenue and cost for different regions, teams, and squads
df = pd.DataFrame({
    "Region": ['North', 'West', 'East', 'South', 'North', 'West', 'East', 'South'],  
    # Regions where revenue and cost are recorded
    "Team": ['Republicans', 'Republicans', 'Republicans', 'Republicans', 'Democrats', 'Democrats', 'Democrats', 'Democrats'],  
    # Teams within each region
    "Squad": ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'],  
    # Squads within each team
    "Revenue": [7500, 5500, 2750, 6400, 2300, 3750, 1900, 575],  
    # Revenue generated by each squad
    "Cost": [5200, 5100, 4400, 5300, 1250, 1300, 2100, 50]  
    # Cost incurred by each squad
})


##### Use apply() to alter values along an axis in **dataframe** or in a **series** by applying a function

# Add a new column 'Profit' to the DataFrame 'df' 
# based on the comparison of 'Revenue' and 'Cost' for each row
df['Profit'] = df.apply(lambda x: 'Profit' if x['Revenue'] > x['Cost'] else 'Loss', axis=1)


# This code adds a new column 'Profit' to the DataFrame 'df', where the value is 
# set to 'Profit' if the revenue ('Revenue' column) is greater than the cost 
# ('Cost' column) for a particular row, and 'Loss' otherwise. The lambda function 
# is applied row-wise using the apply() function along the specified axis. Finally, 
# the updated DataFrame 'df' is displayed.


# Display the updated DataFrame 'df'
df


##### Use map to substitute each value in a **series**, using either a funtion, dictionay, or series.

# Dictionary 'team_map' mapping team names to corresponding colors

# This dictionary 'team_map' is used to map team names to their corresponding 
# colors. Each key-value pair represents a mapping of a team name to a color.

team_map = {
    "Republicans": "Red",  # Map team name 'Republicans' to color 'Red'
    "Democrats": "Blue"  # Map team name 'Democrats' to color 'Blue'
}


# Add a new column 'Team Color' to the DataFrame 'df' 
# by mapping team names to colors using 'team_map'
df['Team Color'] = df['Team'].map(team_map)

# Display the DataFrame 'df'
df

##### Use applymap() to apply a function to each element in your **dataframe**

# Apply the len(str(x)) function to every element in the DataFrame 'df'
# This function calculates the length of the string representation of each element
df.applymap(lambda x: len(str(x)))


### If all else fails, use a for loop.

# Initialize an empty list to store the calculated ratios
new_col = []


# This loop calculates the ratio of the revenue of each row to the total revenue of 
# its corresponding region using a conditional selection based on the 'Region' 
# column. The calculated ratios are stored in the list 'new_col'.


# Iterate over each row in the DataFrame 'df'
for i in range(0, len(df)):
    # Calculate the ratio of revenue of the current row to the total revenue of its corresponding region
    rev = df['Revenue'][i] / df[df['Region'] == df.loc[i, 'Region']]['Revenue'].sum()
    # Append the calculated ratio to the list 'new_col'
    new_col.append(rev)


# Add a new column 'Revenue Share of Region' to the DataFrame 
#'df' containing the values from the list 'new_col'
df['Revenue Share of Region'] = new_col


# After executing this code, the DataFrame 'df' will have a new column 'Revenue 
# Share of Region' containing the calculated revenue shares, and the DataFrame will 
# be sorted based on the 'Region' column. However, please note that the sorting 
# operation doesn't modify the original DataFrame 'df' unless you assign the result 
# back to it or capture it in a new variable.


# Sort the DataFrame 'df' based on the 'Region' column
df.sort_values(by='Region')

```